<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>node portfolio server</title>
</head>
<body>
	<h2> all view </h2>
	<div align="center" class="body">
		<table width = '100%'>
			<tr>
				<td align='center' width='50%'>
					<a href="/">메인 화면</a>
				</td>
				<td align='right' id='countdisp'>
					데이터 개수 : 
				</td>
 			</tr>	
		</table>
		<table border="1" id="notelist" width="100%">
			<tr class="header">
				<th align = "center" width=10%>번호</th>	
				<th align = "center" width=30%>와인 이름</th>
				<th align = "center" width=20%>품종</th>
				<th align = "center" width=20%>분류</th>
				<th align = "center" width=20%>생산국가</th>
			</tr>
		</table>
	</div>
</body>
<script>
	// ajax 객체 생성 
	var xhr = new XMLHttpRequest()
	// 요청 생성 
	xhr.open('get', 'all')
	// 요청 전송 
	xhr.send(null)
	
	// 서버의 응답 처리
	xhr.onreadystatechange = function(){
		if(xhr.readyState == 4) {
			// 정상 응답을 한 경우 
			if(xhr.status >= 200 && xhr.status < 300){
				// 전송된 결과 확인 
				// 텍스트나 json은 responseText
				// XML 은 responseXML
				// alert(xhr.responseText);
				
				// JSON Parsing
				var data = JSON.parse(xhr.responseText);
				
				// 개수 출력 
				var countdisp = document.getElementById("countdisp");
				
				countdisp.innerHTML += data.count + "개"
				
				// 데이터 목록 가져오기 
				var list = data.list;
				
				// 출력할 내용을 저장할 변수를 생성 
				var displayHTML = "";
				
				// 배열 순회 
				list.forEach(function(note){
					displayHTML += "<tr class='record'>";
					displayHTML += "<td align='center'>" + note.winenum + "</td>";
					displayHTML += "<td align='center'>" + "<a href='#' onclick='detail("
							+ note.winenum + ")'>" + note.winename + "</td>";
					displayHTML += "<td align='center'>" + note.varieties + "</td>";
					displayHTML += "<td align='center'>" + note.category + "</td>";
					displayHTML += "<td align='center'>" + note.country + "</td>";
			
					displayHTML += "</tr>";
				})
				
				// 출력
				document.getElementById("notelist").innerHTML += displayHTML;
				
			}
		}	
	}
	
	// 제목을 눌렀을 때 호출되는 함수 
	function detail(winenum){
		// 세션 스토리지에 저장 
		sessionStorage["winenum"] = winenum;
		// 상세보기 페이지로 이동 
		location.href = "getwine"
	}
</script>
</html>