<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>상세보기</title>
</head>
<body>
	<div align='center' id="disp">
		<h2>상폼 상세 보기</h2>
		<table>
			<tr>
				<td><img id='img'/></td>
				<td align='center'>
					<table>
						<tr height='50'>
							<td width='80'>상품명</td>
							<td width='160' id='itemname'></td>
						</tr>
						<tr height='50'>
							<td width='80'>가격</td>
							<td width='160' id='price'></td>
						</tr>	
						<tr height='50'>
							<td width='80'>비고</td>
							<td width='160' id='description'></td>
						</tr>
						<tr>
							<td colspan='2' align='center'
							width='240'>
							<a href="viewall">목록보기</a><br/>
							<a href="#" id="updatebtn">수정하기</a><br/>
							<a href="#" id="deletebtn">삭제하기</a><br/>
							</td>
						</tr>
					</table>
				</td>
				</tr>			
		</table>
	</div>
</body>

<script>
	//조회할 itemid 가져오기
	var itemid = sessionStorage["itemid"];
	//ajax 객체 생성 
	var xhr = new XMLHttpRequest();
	//요청 생성
	xhr.open('get', '/item/detail/' + itemid);
	//요청 전송
	xhr.send(null);
	
	//ajax 응답이 온 경우 호출되는 콜백 처리
	xhr.onreadystatechange = function(){
		if(xhr.readyState == 4){
			if(xhr.status >= 200 && xhr.status < 300){
				//데이터 확인
				// alert(xhr.responseText);
				
				//데이터 파싱
				var object = JSON.parse(xhr.responseText);
				//데이터가 있는 경우
				if(object.result == true){
					//item 키의 값을 가져옵니다.
					var item = object.item;
					document.getElementById("img").src = 
						"../../img/" + item.pictureurl;
					document.getElementById("itemname").innerHTML = 
						item.itemname;
					document.getElementById("price").innerHTML = 
						item.price +"원";
					document.getElementById("description").innerHTML = 
						item.description;
					
					
				}else{
					document.getElementById("disp").innerHTML =
						'<h3>데이터가 존재하지 않습니다.</h3>';
				}
			}
		}
	};
	
	document.getElementById("deletebtn").addEventListener('click', function(e){
		// 삭제 여부를 확인 
		var result = confirm("정말로 삭제하시겠습니까?")
		if(result == true){
			// 삭제할 itemid 찾아오기 
			var itemid = sessionStorage["itemid"];
			
			// ajax 요청 객체 생성 
			var xhr = new XMLHttpRequest(); 
			xhr.open('POST', 'delete', true);
			
			// 파일이 없는 POST 방식의 파라미터를 생성 
			xhr.setRequestHeader('Content-type', "application/x-www-form-urlencoded");
			xhr.send("itemid=" + itemid)
			
			// 결과가 전송되었을 때 수행할 작업 
			xhr.onreadystatechange = function(){
				if(xhr.readyState == 4){
					if(xhr.status >= 200 && xhr.status < 300){
						var obj = JSON.parse(xhr.responseText);
						if(obj.result == true) {
							sessionStorage.clear();
							alert("삭제 완료")
							location.href = 'viewall';	
						} else {
							alert("삭제에 실패하였습니다.")
						}
					}
				}
			}
		}
	});
	
	// 수정하기 링크를 눌렀을 때 수행할 스크립트를 작성
	document.getElementById("updatebtn").addEventListener('click', function(e){
		location.href = 'update';
	})
</script>

</html>